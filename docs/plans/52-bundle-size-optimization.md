# Bundle Size Optimization

> Plan generated by Codex Architect

## Bottom Line

Start by profiling the existing client bundle to spotlight the biggest offenders, then trim React payload by lazy-loading the heavy Radix UI islands and unmounting static sections from hydration. Keep React in place where interaction is rich, but pilot `preact/compat` on the simplest routes if the audit shows a large React core cost.

## Targets

- **Main bundle**: ≥25% reduction
- **Non-interactive routes**: ≤50 KB

## Action Plan

### 1. Run Bundle Audit

Add `rollup-plugin-visualizer` to Vite config:

```typescript
import { visualizer } from 'rollup-plugin-visualizer';

export default defineConfig({
  plugins: [
    visualizer({
      filename: 'analyze.html',
      open: true,
      gzipSize: true,
    }),
  ],
});
```

Capture and record:
- Total JS shipped
- React/Radix share of bundle
- Initial route sizes

### 2. Lazy-Load Radix Components

Priority order (heaviest first):
1. `Dialog`
2. `DropdownMenu`
3. `Tabs`

Example pattern:

```typescript
const Dialog = lazy(() => import('@radix-ui/react-dialog'));

function MyComponent() {
  return (
    <Suspense fallback={<DialogSkeleton />}>
      <Dialog>...</Dialog>
    </Suspense>
  );
}
```

Measure per-component savings after each change.

### 3. Strip Hydration from Static Blocks

Identify sections that render once and don't need interactivity:
- Hero sections
- Markdown content blocks
- Static lists

Options:
- Vite `index.html` partials
- `dangerouslySetInnerHTML` with serialized markup

Confirm zero JS for those chunks via post-build stats.

### 4. Evaluate Preact/Compat

Spin a branch with `@preact/preset-vite`:

```typescript
// vite.config.ts
import preact from '@preact/preset-vite';

export default defineConfig({
  plugins: [preact()],
  resolve: {
    alias: {
      'react': 'preact/compat',
      'react-dom': 'preact/compat',
    },
  },
});
```

**Proceed only if:**
- Saves ≥35 KB
- Radix support holds
- Tests pass

Keep opt-in flag to revert quickly.

### 5. Automate Regression Checks

- CI gate comparing `dist/**/*.js` sizes
- Fail on >5% regression
- Lighthouse run to ensure no functionality loss

## Effort Estimate

**Short** (1-4 hours)

## Success Criteria

- [ ] Bundle audit completed and documented
- [ ] At least 2 Radix components lazy-loaded
- [ ] Static sections identified and optimized
- [ ] Preact/compat feasibility evaluated
- [ ] Regression checks in CI
